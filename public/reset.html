<!DOCTYPE html>
<html>
<head><title>Reset Password</title></head>
<body>
<h1>Reset Password</h1>
<form id="resetForm">
  <input type="password" id="password" placeholder="New password" required>
  <input type="hidden" id="token">
  <button type="submit">Reset Password</button>
</form>
<div id="msg"></div>
<script>
  const params = new URLSearchParams(location.search);
  const form = document.getElementById('resetForm');
  const msgEl = document.getElementById('msg');
  const submitBtn = form.querySelector('button[type="submit"]');
  const token = params.get('token');

  if (!token) {
    msgEl.innerText = 'Reset link is invalid or expired';
    submitBtn.disabled = true;
  } else {
    document.getElementById('token').value = token;
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const password = document.getElementById('password').value;
      const res = await fetch('/auth/local/reset', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token, password })
      });
      msgEl.innerText = res.ok ? 'Password updated' : 'Reset failed';
    });
  }
</script>
</body>
</html>
